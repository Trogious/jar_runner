#!/bin/sh -
yum install -y python3 java-1.8.0-openjdk.x86_64
pip3 install boto3
echo 'IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwppbXBvcnQgYm90bzMKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGpzb24KaW1wb3J0IGRhdGV0aW1lCmltcG9ydCBvcwoKQlVDS0VUX05BTUVfSU4gPSAncnRwLWlucHV0LWphcnMnCkJVQ0tFVF9OQU1FX09VVCA9ICdydHAtb3V0cHV0LXJlc3VsdHMnClBSRUZJWF9ESVIgPSAnLi9yZXN1bHRzXycKUkVTVUxUU19PVVQgPSAncmVzdWx0c19vdXQudHh0JwpSRVNVTFRTX0VSUiA9ICdyZXN1bHRzX2Vyci50eHQnCgoKZGVmIGV4dHJhY3RfamFyX25hbWUoYm9keSk6CiAgICBwcmludChib2R5KQogICAgcGFyc2VkID0ganNvbi5sb2Fkcyhib2R5KQogICAgcmV0dXJuIHBhcnNlZFsnbmFtZSddCgoKZGVmIGNvbXByZXNzX3Jlc3VsdHMoZGlyX3BhdGgpOgogICAgaW1wb3J0IHRhcmZpbGUKICAgIGFyY2hpdmUgPSBkaXJfcGF0aFs6LTFdICsgJy50Z3onCiAgICB3aXRoIHRhcmZpbGUub3BlbihhcmNoaXZlLCAndzpneicpIGFzIHRhcjoKICAgICAgICBmb3Igcm9vdCwgZGlycywgZmlsZXMgaW4gb3Mud2FsayhkaXJfcGF0aCk6CiAgICAgICAgICAgIGZvciBmaWxlX25hbWUgaW4gZmlsZXM6CiAgICAgICAgICAgICAgICB0YXIuYWRkKHJvb3QgKyBmaWxlX25hbWUpCiAgICByZXR1cm4gYXJjaGl2ZQoKCmRlZiBleGVjdXRlX2phcihqYXIpOgogICAgcHJlZml4X2RpciA9IFBSRUZJWF9ESVIgKyBqYXIucmVwbGFjZSgnLmphcicsICcnKSArICdfJyArIGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLmlzb2Zvcm1hdChzZXA9J18nKVs6MTldLnJlcGxhY2UoJzonLCAnLScpICsgJy8nCiAgICBvcy5ta2RpcihwcmVmaXhfZGlyLCAwbzcwMCkKICAgIHdpdGggb3BlbihwcmVmaXhfZGlyICsgUkVTVUxUU19PVVQsICd3YicpIGFzIGZvOgogICAgICAgIHdpdGggb3BlbihwcmVmaXhfZGlyICsgUkVTVUxUU19FUlIsICd3YicpIGFzIGZlOgogICAgICAgICAgICBzMyA9IGJvdG8zLnJlc291cmNlKCdzMycpCiAgICAgICAgICAgIHByaW50KCdkb3dubG9hZGluZycpCiAgICAgICAgICAgIHMzLm1ldGEuY2xpZW50LmRvd25sb2FkX2ZpbGUoQlVDS0VUX05BTUVfSU4sICdqYXJzLycgKyBqYXIsICcuLycgKyBqYXIpCiAgICAgICAgICAgIHByaW50KCdleGVjdXRpbmcnKQogICAgICAgICAgICB3aXRoIHN1YnByb2Nlc3MuUG9wZW4oWydqYXZhJywgJy1qYXInLCAnLi8nICsgamFyXSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSkgYXMgcDoKICAgICAgICAgICAgICAgIG91dCwgZXJyID0gcC5jb21tdW5pY2F0ZSgpCiAgICAgICAgICAgICAgICBpZiBvdXQgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICBwcmludCgnbm8gb3V0cHV0JykKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZm8ud3JpdGUob3V0KQogICAgICAgICAgICAgICAgaWYgZXJyIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoJ25vIGVycm9yJykKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmUud3JpdGUoZXJyKQogICAgcHJpbnQoJ2NvbXByZXNzaW5nJykKICAgIHJlc3VsdHNfYXJjaGl2ZSA9IGNvbXByZXNzX3Jlc3VsdHMocHJlZml4X2RpcikKICAgIHByaW50KHJlc3VsdHNfYXJjaGl2ZSkKICAgIHByaW50KCd1cGxvYWRpbmcnKQogICAgczMubWV0YS5jbGllbnQudXBsb2FkX2ZpbGUocmVzdWx0c19hcmNoaXZlLCBCVUNLRVRfTkFNRV9PVVQsIG9zLnBhdGguYmFzZW5hbWUocmVzdWx0c19hcmNoaXZlKSkKICAgIHByaW50KCd1cGxvYWRlZCcpCgoKZGVmIG1haW4oKToKICAgIHNxcyA9IGJvdG8zLnJlc291cmNlKCdzcXMnLCByZWdpb25fbmFtZT0nZXUtY2VudHJhbC0xJykKICAgIHRyeToKICAgICAgICBxdWV1ZSA9IHNxcy5nZXRfcXVldWVfYnlfbmFtZShRdWV1ZU5hbWU9J3J0cF9xdWV1ZV9zY2hlZHVsZScpCiAgICAgICAgZm9yIG1lc3NhZ2UgaW4gcXVldWUucmVjZWl2ZV9tZXNzYWdlcyhNYXhOdW1iZXJPZk1lc3NhZ2VzPTEsIFdhaXRUaW1lU2Vjb25kcz0xMCk6CiAgICAgICAgICAgIGJvZHkgPSBtZXNzYWdlLmJvZHkKICAgICAgICAgICAgbWVzc2FnZS5kZWxldGUoKQogICAgICAgICAgICBleGVjdXRlX2phcihleHRyYWN0X2phcl9uYW1lKGJvZHkpKQogICAgICAgICAgICBicmVhawogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGUpCgoKaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoKICAgIG1haW4oKQo=' | base64 -d - > /home/ec2-user/jar_ec2_execute.py
chmod 700 /home/ec2-user/jar_ec2_execute.py
chown ec2-user:ec2-user /home/ec2-user/jar_ec2_execute.py
su - ec2-user -c /home/ec2-user/jar_ec2_execute.py
/usr/sbin/poweroff
